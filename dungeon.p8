pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--웃g dungeon웃
--m ivkovic

function _init()
	map_setup()
	make_player()
end

function _update()
	move_player()
	set_camera()
end

function _draw()
	cls()
	draw_map()
	draw_player()
	rectfill(cx,cy,cx+24,cy+6,0)
	print("keys:"..p.keys,cx+1,cy+1,10)
end
-->8
--map

function map_setup()
	--map tile settings
	wall=0
	key=1
	door=2
	anim1=3
	anim2=4
	
	lose=6
	win=7
end

function draw_map()
	map(0,0,0,0,32,16)
end

--find if sprite at x,y has flag
function is_tile(tile_type,x,y)
	tile=mget(x,y)
	has_flag=fget(tile,tile_type)
	return has_flag
end

function can_move(x,y)
	return not is_tile(wall,x,y)
end

function set_camera()
	cx=p.x*8-60
	cy=p.y*8-60
	if (p.x*8<64) then cx=0 end
	if (p.y*8<64) then cy=0 end
	camera(cx,cy)
end

function swap_tile(x,y)
	--get tile at x,y and switch to next tile sprite
	tile=mget(x,y)
	mset(x,y,tile+1)
end

function get_key(x,y)
	p.keys+=1
	swap_tile(x,y)
	sfx(1)
end

function open_door(x,y)
	p.keys-=1
	swap_tile(x,y)
	sfx(2)
end	
-->8
--player

function make_player()
	p={}
	p.x=3
	p.y=2
	p.spr=1
	p.spr_flip=false
	p.keys=0
end

function draw_player()
	spr(p.spr,p.x*8,p.y*8,1,1,p.spr_flip)
end

function move_player()
	newx=p.x
	newy=p.y
	
	if (btnp(⬅️)) then
		newx-=1
		p.spr_flip=false
	end
	if (btnp(➡️)) then 
		newx+=1
		p.spr_flip=true
	end
	if (btnp(⬆️)) newy-=1
	if (btnp(⬇️)) newy+=1
	
	interact(newx,newy)
	
	if (can_move(newx,newy)) then
		p.x=mid(0,newx,31)
		p.y=mid(0,newy,15)
	else
		sfx(0)	
	end
end

function interact(x,y)
	if (is_tile(key,x,y)) then
		get_key(x,y)
	elseif (is_tile(door,x,y) and p.keys>0) then
		open_door(x,y)
	end
end
__gfx__
00000000600444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006000f4400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007006000ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000faffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000400fffaf0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000444f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000f4f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004404400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555445445447765776555566555555665550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555557665766555644655556556550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555544544545555555556444465565555650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555557657765764544546645555460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555454454456657665774444447745555470000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
555555555555555555555555644aa446645555460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555445445446577657774444447745555470000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555556576657664444446645555460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000055555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000aaa55555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000a9aaaaaa555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000a5a99a9a555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000aaa55959555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000099955555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000055555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000055555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000105000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1212121212121212121212121212121212121212121212121212121212121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210101010101010141010101010101010101210101010101310101010101112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210101010101010121010101010101010101210101010101210101010101112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210101010101010121110101010101023101210101010101210101010101112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1211111110101010121110121214121212121210101010101212121213121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1211101010101010121110101011111111111111101010101210101010101112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210101010101010121010101010101010101010101010111210101010101112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210101010101010121010101010101010101010101010111210101010101112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121110101011121010101010101010101011111110111213121212121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210121110101011121010101010101010101010101010101210101010101012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210101211101010111010101010101010101010101010101210101010101012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210111211101010101010101010101111111111111110101211111110101012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210111211101010101010101010111110101010101010101212121212121012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210111211101010101010101010101010101010101010101010101010121012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1223111210101010101010101010101010101010101010101010101023121012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212121212121212121212121212121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
a60400000a01305021040130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
300200002b0302b0302b0103702237022370223702237015370252e0001f0001f000240001f0001d0001800000000000000000000000000000000000000000000000000000000000000000000000000000000000
03030000077240f73113721187221d726227250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
