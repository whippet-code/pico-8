pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--invader like
--m.ivkovic (whippet)

function _init()
	_ugm=update_start
	_dgm=draw_start
	
	aliens={}
	make_alien(6)
	
	make_player()
	bullets={}
	
	track=0
	dir=1
end

function _update()
	_ugm()
	if track<30 then
		track+=1
	else
		track=0
		dir*=-1
	end
end

function _draw()
	cls()
	_dgm()
end
-->8
--update

function update_start()
	_ugm=_init
	if btnp(‚ùé) then 
		_ugm=update_game
		_dgm=draw_game
	end
end

function update_game()
	for i=#aliens,1,-1 do
		local a=aliens[i]
		update_alien(a)
		check_alien(a)
	end
	if #aliens==0 then
		_ugm=update_win
		sfx(4)
	end
	update_player()
	update_bullets()
end

function update_gameover()
	_dgm=draw_gameover
end

function update_win()
	_dgm=draw_win
end
-->8
--draw

function draw_start()
	print("üê± invader like ‚òÖ",30,40,4)
	print("press ‚ùé to play",33,60,6)
end

function draw_game()
	for i=1, #aliens do
		local a=aliens[i]
		draw_alien(a)
	end
	
	draw_player()
	draw_bullets()
end

function draw_gameover()
	cls()
	print("ded!",40,40,6)
end

function draw_win()
	cls()
	print("winner",40,40,6)
end
-->8
--aliens

function make_alien(n)
	for i=0,n-1 do
		local a={}
		a.x=(i*11)+4
		a.y=4
		a.sprite=32
		
		local b={}
		b.x=(i*11)+6
		b.y=16
		b.sprite=33
		
		local c={}
		c.x=(i*11)+4
		c.y=28
		c.sprite=32
		
		add(aliens,a)
		add(aliens,b)
		add(aliens,c)
	end
end

function draw_alien(a)
	spr(a.sprite,a.x,a.y)
end

function update_alien(a)
	if track<30 then
		a.x+=2*dir
	else
		a.y+=6
		sfx(0)
	end
end

--collsions
function check_alien(a)
	for j=#bullets,1,-1 do
		local b=bullets[j]
		if b.x>a.x and 
			b.x<a.x+8 and
			b.y>a.y and
			b.y<a.y+8 then
					
			del(aliens,a)
			del(bullets,b)
			sfx(2)
		end	
	end
	if a.x<=p.x+8 and
				a.x+8>=p.x and
				a.y+8>p.y and
				a.y<p.y+8 then
		_ugm=update_gameover
	end
end


-->8
--player

function make_player()
	p={}
	p.x=60
	p.y=120
	p.sprite=16
end

function update_player()
	if btn(‚¨ÖÔ∏è) then
		p.x-=2
	end
	if btn(‚û°Ô∏è) then
		p.x+=2
	end
	if btnp(‚ùé) then
		if #bullets<3 then
			shoot()
			sfx(1)
		end
	end
end

function draw_player()
	spr(p.sprite,p.x,p.y)
end
-->8
--bullets

function make_bullet()
	local b={}
	b.x=p.x+3
	b.y=p.y
	
	add(bullets,b)
end

function shoot()
	make_bullet()
end

function update_bullets()
	for i=#bullets,1,-1 do
		local b=bullets[i]
		--check collision
		--update position
		if b.y>0 then
			b.y-=4
		else
			del(bullets,b)
		end
	end
end

function draw_bullets()
	for i=1,#bullets do
		local b=bullets[i]
		circfill(b.x,b.y,1)
	end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
006cc600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007cc700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077cc770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
67566576000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66555566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
605aa506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb00000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbb000b0000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0000b0b000000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b030030bb030030b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b000000b0bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbb0000b00b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb00bbb0bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
9203000002112051221f13304122001120010300103001030010300103001030010300103001030010300103001030010300103001030010300103001033f1030010300103001030010300103001030010300103
a703000007551075513b5513255123551005010050100501005010050100501005010050100501005010050100501005010050100501005010050100501005010050100501005010050100501005010050100501
170300000e6551a6353c6250060500605006050060500605006050060500605006050060500605006050060500605006050060500605006050060500605006050060500605006050060500605006050060500605
50100000005231b5031762300503005230a50317623005030052313503176230050300523265031762313503005231b50317623245030052318503165031f5030052327503176231762300523176231762317623
8c100000305222b522265322453224532145421f5321f5322c5222952226532225321f5321d532185321353224532225221f5221d5221d5221f522225221f5221f5220c5221852216522185321b5221d53218532
__music__
00 03424344

